# 📝 문제 정의 및 요구사항 분석

## ⚙️ 문제 정의 

### 🎯 해결하고자 하는 것
- 콘서트 예약을 위한 대기열 시스템을 만들어야 한다.
- 콘서트 예약 시 대기열을 이용하여 고객이 순차적으로 예약을 할 수 있어야 한다.
- 좌석 예약 요청 시 결제가 이뤄지지 않더라도 일정 시간 동안 다른 유저가 해당 좌석에 접근하면 안 된다.
- 결제가 완료되면 대기열에서 빠져나와야 한다.

### 🔍 문제에 대해 추상적/구체적인 접근
- **대기열 시스템을 만들어야 한다**
    - 콘서트 예약에선 고객이 한 번에 몰릴 수 있다.
    - 고객이 순차적으로 예약 절차를 진행할 수 있어야 한다.
    - 접근한 고객 관리는 어떻게 할 것인가?
        - 유저 요청 순서대로 대기열에 추가
        - 먼저 들어온 유저가 먼저 나가도록 한다
        - 유저별 토큰 발급
        - 고객은 자신의 대기 상태를 조회할 수 있어야 한다.

    - **어떤 API가 필요할까?**
        - 대기열 토큰 발급 API
            - 유저 `uuid`, 대기 순서, 잔여 시간, 토큰
        - 대기 번호 조회 API
            - 토큰, 현재 대기 번호, 잔여 시간, 대기 상태 여부

- **고객에게 예약 가능한 날짜와 좌석 번호를 제공해야 한다**
    - 대기열을 통과한 고객만 예약을 할 수 있다.
        - 토큰의 상태 검증이 필요해 보인다.
    - 날짜 및 좌석 선택은 중복되어선 안 된다.
        - 동일 날짜, 동시간대 같은 좌석은 중복될 수 없다.

    - **어떤 API가 필요한가?**
        - 예약 가능한 날짜 조회 API
            - Output : 예약 가능한 날짜
        - 예약 가능한 좌석 조회 API
            - Input : 날짜 정보
            - Output : 예약 가능한 좌석 번호

- **고객이 선택한 좌석을 예약 요청한다**
    - 고객이 선점한 좌석의 상태를 예약 불가 상태로 전환한다(5분간).

    - **어떤 API가 필요할까?**
        - 좌석 예약 요청 API (해당 좌석의 상태를 변경한다)
            - Input : `uuid`, 날짜, 좌석 번호
            - Output : 좌석 상태

- **결제할 때 사용할 금액을 충전 및 조회할 수 있어야 한다**
    - 충전할 금액은 양수여야 하며 최소 금액은 정책에 따라 명시한다.
    - 예약 진행 중에는 충전을 할 수 없다.

    - **필요한 API**
        - 잔액 충전 API
            - Input : `uuid`, 충전 금액
            - Output : `uuid`, 총 충전 금액
        - 잔액 조회 API
            - Input : `uuid`
            - Output : `uuid`, 총 잔액

    - **동시성 제어**
        - 잔액 충전 시에 동시성 이슈 발생할 수 있다.
        - 동시성을 제어할 수 있어야 한다. (일단은 Lock)

- **예약한 좌석을 결제 처리할 수 있어야 한다**
    - 결제하고 결제 내역을 생성하며 예약 좌석의 상태를 완전히 불가로 변경한다.
        - 좌석의 상태를 결제 완료 상태로 변경한다.
        - 고객의 잔액에서 결제 금액을 차감한다.
        - 결제 완료가 되면 결제 내역을 생성한다.
        - 잔액이 부족하면 결제가 실패되며, 현재 잔액을 알려주면 결제가 실패된다.
    - 결제가 성공하든 실패하든 해당 대기열 토큰을 만료시킨다.

    - **필요한 API**
        - 결제 API
            - Input : `uuid`, 결제 금액
            - Output : 성공 여부, 잔액

---

## 📊 요구사항 분석 

### 🔧 기능적 요구사항
어떤 기능을 제공할 수 있는가?
- 대기열 토큰 생성 기능
- 대기번호 조회 기능
- 대기열 토큰 상태 조회 기능
- 예약 가능 날짜 조회 기능
- 예약 가능 좌석 조회 기능
- 좌석 상태 확인 기능
- 좌석 상태 변경 기능
- 잔액 조회 기능
- 충전 기능
- 결제 기능
- 결제 내역 생성 기능
- 결제 내역 조회 기능
- 대기열 토큰 만료 기능

### ⚡ 비기능적 요구사항
성능, 확장성, 보안 관련한 추가적인 고려사항들을 고려할 수 있는가?

- **성능**
    - 대기열 API 응답은 1초 내외여야 한다.
    - 대기열 서버는 초당 최대 1,000명의 유저 요청을 처리할 수 있어야 한다.
        - -> 규모를 고려해야 해서 최대 대기열 접근 인원 수 선정

- **보안**
    - 대기열 토큰이 유효 시간이 지나면 자동으로 만료되어야 한다.
    - 모든 API는 HTTPS를 사용해야 한다.

- **일관성**
    - 좌석 점유 상태는 모든 서버에서 일관되게 유지되어야 한다.
